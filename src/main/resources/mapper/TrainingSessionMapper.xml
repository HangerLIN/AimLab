<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aimlab.mapper.TrainingSessionMapper">
    <!-- 结果映射 -->
    <resultMap id="trainingSessionMap" type="com.aimlab.entity.TrainingSession">
        <id property="id" column="id"/>
        <result property="athleteId" column="athlete_id"/>
        <result property="sessionName" column="session_name"/>
        <result property="startTime" column="start_time"/>
        <result property="endTime" column="end_time"/>
        <result property="notes" column="notes"/>
    </resultMap>
    
    <!-- 插入新训练场次 -->
    <insert id="insert" parameterType="com.aimlab.entity.TrainingSession" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO training_sessions (athlete_id, session_name, start_time, end_time, notes)
        VALUES (#{athleteId}, #{sessionName}, #{startTime}, #{endTime}, #{notes})
    </insert>
    
    <!-- 根据ID查询训练场次 -->
    <select id="findById" resultMap="trainingSessionMap">
        SELECT * FROM training_sessions WHERE id = #{id}
    </select>
    
    <!-- 根据运动员ID查询训练场次列表 -->
    <select id="findByAthleteId" resultMap="trainingSessionMap">
        SELECT * FROM training_sessions WHERE athlete_id = #{athleteId} ORDER BY start_time DESC
    </select>
    
    <!-- 更新训练场次信息 -->
    <update id="update" parameterType="com.aimlab.entity.TrainingSession">
        UPDATE training_sessions
        SET session_name = #{sessionName},
            notes = #{notes},
            end_time = #{endTime}
        WHERE id = #{id}
    </update>
    
    <!-- 结束训练场次（设置结束时间） -->
    <update id="endSession">
        UPDATE training_sessions
        SET end_time = #{endTime}
        WHERE id = #{id}
    </update>
</mapper> 
