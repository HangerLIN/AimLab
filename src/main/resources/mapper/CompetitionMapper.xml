<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aimlab.mapper.CompetitionMapper">
    <!-- 结果映射 -->
    <resultMap id="competitionMap" type="com.aimlab.entity.Competition">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="description" column="description"/>
        <result property="roundsCount" column="rounds_count"/>
        <result property="shotsPerRound" column="shots_per_round"/>
        <result property="timeLimitPerShot" column="time_limit_per_shot"/>
        <result property="status" column="status"/>
        <result property="createdBy" column="created_by"/>
        <result property="createdAt" column="created_at"/>
        <result property="startedAt" column="started_at"/>
        <result property="endedAt" column="ended_at"/>
        <result property="completedAt" column="completed_at"/>
        <result property="durationSeconds" column="duration_seconds"/>
    </resultMap>
    
    <!-- 插入新比赛 -->
    <insert id="insert" parameterType="com.aimlab.entity.Competition" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO competitions (name, description, rounds_count, shots_per_round, time_limit_per_shot, status, created_by, created_at, started_at, ended_at, completed_at, duration_seconds)
        VALUES (#{name}, #{description}, #{roundsCount}, #{shotsPerRound}, #{timeLimitPerShot}, #{status}, #{createdBy}, #{createdAt}, #{startedAt}, #{endedAt}, #{completedAt}, #{durationSeconds})
    </insert>
    
    <!-- 根据ID查询比赛 -->
    <select id="findById" resultMap="competitionMap">
        SELECT * FROM competitions WHERE id = #{id}
    </select>
    
    <!-- 更新比赛信息 -->
    <update id="update" parameterType="com.aimlab.entity.Competition">
        UPDATE competitions
        SET name = #{name},
            description = #{description},
            rounds_count = #{roundsCount},
            shots_per_round = #{shotsPerRound},
            time_limit_per_shot = #{timeLimitPerShot},
            status = #{status},
            started_at = #{startedAt},
            ended_at = #{endedAt},
            completed_at = #{completedAt},
            duration_seconds = #{durationSeconds}
        WHERE id = #{id}
    </update>
    
    <!-- 更新比赛状态 -->
    <update id="updateStatus">
        UPDATE competitions
        SET status = #{status}
        WHERE id = #{id}
    </update>
    
    <!-- 查询所有比赛 -->
    <select id="findAll" resultMap="competitionMap">
        SELECT * FROM competitions ORDER BY created_at DESC
    </select>
    
    <!-- 根据状态查询比赛 -->
    <select id="findByStatus" resultMap="competitionMap">
        SELECT * FROM competitions WHERE status = #{status} ORDER BY created_at DESC
    </select>
    
    <!-- 根据创建者ID查询比赛 -->
    <select id="findByCreatedBy" resultMap="competitionMap">
        SELECT * FROM competitions WHERE created_by = #{createdBy} ORDER BY created_at DESC
    </select>
</mapper> 
